stages:
  - build
  - deploy

before_script:
  - source ~/.bashrc
  - cd /var/www/lms-face-recognizer

build_job:
  stage: build
  script:
    - git checkout $CI_COMMIT_REF_NAME
    - git reset --hard
    - git clean -fd
    - git pull origin $CI_COMMIT_REF_NAME
    - git show --summary
    - uv sync
    - echo "Build complete"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "push"'
  tags:
    - self-host

deploy_job:
  stage: deploy
  script:
    - systemctl restart lms-face-recognition
    - echo "Deploy complete"
  tags:
    - self-host
